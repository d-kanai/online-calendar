Feature: カレンダーにおける会議管理機能
  会議の作成、参加者の招待、時間変更などを適切に管理したい

  Rule: 参加者の招待はオーナーのみ可能

    Scenario: オーナーが参加者を追加する
      Given オーナーが新しい会議を作成している
      When オーナーが1人の参加者を追加する
      Then 追加された参加者に通知が送信される

    Scenario: 招待された参加者は他の参加者を招待できない
      Given 参加者が既に会議に招待されている
      Then その参加者は他の人を招待できない

  Rule: 会議の参加者数は50人まで

    Scenario: 参加者数が50人未満のときに追加する
      Given 会議に49人の参加者がいる
      When オーナーがさらに1人を追加する
      Then その参加者が追加され、通知が送信される

    Scenario: 参加者数が50人に達している場合
      Given 会議に既に50人の参加者がいる
      When オーナーがもう1人を追加しようとする
      Then 「参加者の上限に達しました」というエラーメッセージが表示される

  Rule: 会議の詳細変更はオーナーのみ可能

    Scenario: 会議の時間を変更する
      Given 現在が7:00 AMで、10:00 AMに会議が設定されている
      When オーナーがその会議の時間を11:00 AMに変更する
      Then 参加者全員に時間変更の通知が送信される

    Scenario: 参加者は会議名を変更できない
      Given 会議に参加している招待者がいる
      Then その参加者は会議名を変更できない

  Rule: 会議の変更内容は自動的に適用される

    Scenario: 会議変更に同意は不要
      Given オーナーが会議の詳細を変更した
      Then すべての変更は即時適用され、通知のみが送信される

  Rule: 会議の登録時は他の会議と時間が重複してはならない

    Scenario: 重複した会議を登録しようとする
      Given ユーザーが11:00 AMに既に会議を登録している
      When 同じ時間に別の会議を作成しようとする
      Then 「他の会議と時間が重複しています」というエラーが表示され、作成できない

  Rule: すでに開始した会議は変更・削除できない

    Scenario: 進行中または終了済みの会議を変更しようとする
      Given 現在の時刻が会議の開始時刻を過ぎている
      When オーナーがその会議の時間やタイトルを変更しようとする
      Then 「開始済みの会議は変更できません」というエラーが表示される

    Scenario: 進行中または終了済みの会議を削除しようとする
      Given 現在の時刻が会議の開始時刻を過ぎている
      When オーナーがその会議を削除しようとする
      Then 「開始済みの会議は削除できません」というエラーが表示される
      And 会議は削除されずに残る

    Scenario: 未来の会議を削除する
      Given 現在の時刻が会議の開始時刻より前である
      When オーナーがその会議を削除する
      Then 会議が削除される
      And 参加者全員に削除通知が送信される

  Rule: リマインダーは会議の重要度に応じて送信される

    Scenario: 通常会議のリマインダー
      Given 通常の会議が10:00 AMに設定されている
      When リマインダー送信時刻になる
      Then 参加者全員に15分前（9:45 AM）にリマインダーが送信される

    Scenario: 重要会議のリマインダー
      Given 重要フラグ付きの会議が10:00 AMに設定されている
      When リマインダー送信時刻になる
      Then 参加者全員に60分前（9:00 AM）にリマインダーが送信される

  Rule: 通知は参加者の設定チャネルでのみ送信される

    Scenario: メール通知が有効な参加者への送信
      Given 参加者がメール通知を有効にしている
      When 会議の通知イベントが発生する
      Then その参加者にメールで通知が送信される
      And 送信ステータスが記録される

    Scenario: 通知チャネルが無効な参加者
      Given 参加者がすべての通知チャネルを無効にしている
      When 会議の通知イベントが発生する
      Then その参加者には通知が送信されない
      And 未送信ステータスが記録される

  Rule: 会議の基本データ要件

    Scenario: 必須項目なしでの会議作成
      Given オーナーがログインしている
      When タイトルまたは開始時刻が未入力で会議を作成しようとする
      Then 「必須項目が入力されていません」というエラーが表示される

    Scenario: 終了時刻が開始時刻より早い場合
      Given オーナーが会議を作成している
      When 終了時刻を開始時刻より早く設定する
      Then 「終了時刻は開始時刻より後に設定してください」というエラーが表示される

  Rule: 参加者の退会は自由

    Scenario: 参加者が会議から退会する
      Given 参加者が会議に招待されている
      When その参加者が会議から退会する
      Then 参加者リストから削除される
      And オーナーに退会通知が送信される

  Rule: 参加者権限管理
    参加者の権限を適切に制御し、会議の整合性を維持する
    オーナーと参加者の役割を明確に分離する

    Scenario: オーナーのみが参加者を削除可能
      Given オーナーが会議を作成している
      And 会議に参加者が追加されている
      When オーナーが参加者を削除する
      Then 参加者が会議から削除される
      And 削除された参加者に通知が送信される

    Scenario: 参加者は他の参加者を削除できない
      Given 参加者として会議に招待されている
      When その参加者が他の参加者を削除しようとする
      Then 削除操作が拒否される
      And 「権限がありません」エラーが表示される

    Scenario: 参加者が自分の通知設定を変更
      Given 参加者が会議に招待されている
      When その参加者が自分のメール通知設定を変更する
      Then 通知設定が更新される
      And 設定変更が即座に反映される

    Scenario: オーナーが参加者の通知設定を変更
      Given オーナーが会議を管理している
      And 会議に参加者がいる
      When オーナーが参加者の通知設定を変更する
      Then その参加者の通知設定が更新される
      And 変更内容が参加者に通知される