appId: dkanai.OnlineCalendar
tags:
  - auth
  - signin
env:
  API_URL: "http://localhost:3001"
---
# サインインフローのE2Eテスト

# Setup: 全てのテストデータをリセット
- runScript:
    file: ../scripts/reset_all_data.js
    env:
      API_URL: ${API_URL}

# Given: テストユーザーがバックエンドに存在する
- runScript:
    file: ../scripts/setup_test_data.js
    env:
      API_URL: ${API_URL}
      TABLE: "user"
      DATA: |
        {
          "id": "e2e-test-user",
          "email": "test@example.com",
          "password": "e2e-test-password",
          "name": "E2E Test User"
        }

# When: アプリを起動
- launchApp:
    clearState: true

# サインイン画面が表示されることを確認
- assertVisible: "Online Calendar"

# メールアドレスを入力（即座にタップして高速入力）
- tapOn: "メールアドレス"
- inputText: "test@example.com"

# パスワードを入力（即座にタップして高速入力）
- tapOn: "パスワード"  
- inputText: "e2e-test-password"

# キーボードを閉じる
- hideKeyboard

# サインインボタンをタップ
- tapOn: "サインイン"

# 認証処理が完了するまで待機（最大10秒）
- waitForAnimationToEnd:
    timeout: 3000

# ホームタブが表示されることを確認（サインイン成功）
- assertVisible: "ホーム"